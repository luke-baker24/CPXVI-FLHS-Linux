cronscan()
{
    #Look for running crontabs
    #grep -rv "#" /var/spool/cron/crontabs/

    #Some crontabs can be hidden from the running crontab and instead are here
    ls -A /etc/cron.d/
    ls -A /etc/cron.daily/
    ls -A /etc/cron.hourly/
    ls -A /etc/cron.monthly/
    ls -A /etc/cron.weekly/

    #Some cronjobs appear here instead
    echo ""
    grep -v "#" /etc/anacrontab
    grep -v "#" /etc/crontab
}

bashenvscan()
{
    getent passwd | egrep ":[0-9][0-9][0-9][0-9]:" | while IFS=: read -r name password uid gid gecos home shell
    do
        diff /home/$name/.bashrc ../baselines/bashrc    
        diff /home/$name/.profile ../baselines/profile
        diff /home/$name/.basah_logout ../baselines/bash_logout
    done

    echo "Path is: " + $PATH
}

rootkitscan()
{
    #Rkhunter scan
    rkhunter --checkall --skip-keypress --nocolors

    #Chkrootkit scan
    chkrootkit
}

malwarescan()
{
    #Clamscan
    clamscan -r / --suppress-ok-results --exclude-dir=^/snap/ / 2> /dev/null

    #Maldet scan
    wget https://www.rfxn.com/downloads/maldetect-current.tar.gz
    gunzip maldetect-current.tar.gz
    tar -xvf maldetect-current.tar

    cd $(ls | grep maldetect | grep -v zip)
        ./install.sh
    cd ..

    maldet --scan-all /
}

networkscan()
{
    netstat -alpn | grep LISTEN
    nmap -sV localhost
}

filescan()
{
    ALL_FILES=$(find /home/$USER -type f -exec file {} + | 
    grep -v /home/$USER/snap/ | 
    grep -v /home/$USER/.config/ | 
    grep -v /home/$USER/.cache/ | 
    grep -v /home/$USER/.bash_history |
    grep -v /home/$USER/.bash_logout | 
    grep -v /home/$USER/.bashrc |
    grep -v /home/$USER/Downloads/CPXV-FLHS*/)
    
    echo "$ALL_FILES" | grep jpg
    echo "$ALL_FILES" | grep png
    echo "$ALL_FILES" | grep mp3
    echo "$ALL_FILES" | grep mp4
    echo "$ALL_FILES" | grep mov
    echo "$ALL_FILES" | grep wav
    echo "$ALL_FILES" | grep avi
    echo "$ALL_FILES" | grep mpg
    echo "$ALL_FILES" | grep mpeg
    echo "$ALL_FILES" | grep flac
    echo "$ALL_FILES" | grep m4a
    echo "$ALL_FILES" | grep flv
    echo "$ALL_FILES" | grep ogg
    echo "$ALL_FILES" | grep gif
    echo "$ALL_FILES" | grep jpeg
    echo "$ALL_FILES" | grep txt
    echo "$ALL_FILES" | grep zip
    echo "$ALL_FILES" | grep deb
    echo "$ALL_FILES" | grep tar
    echo "$ALL_FILES" | grep rar
    echo "$ALL_FILES" | grep gz
    echo "$ALL_FILES" | grep sh
    echo "$ALL_FILES" | grep pdf
    echo "$ALL_FILES" | grep svg
    echo "$ALL_FILES" | grep pass
    echo "$ALL_FILES" | grep word
    echo "$ALL_FILES" | grep pw
    echo "$ALL_FILES" | grep russia
    echo "$ALL_FILES" | grep china
    echo "$ALL_FILES" | grep hack
    echo "$ALL_FILES" | grep exploit
}

echo "
=====================================================================
Running a malware scan
=====================================================================
" >> $1/fluff.log

cronscan      >> $1/fluff.log
rootkitscan  >> $1/fluff.log
malwarescan   >> $1/fluff.log
bashenvscan   >> $1/fluff.log
#networkscan   >> $1/fluff.log
#filescan      >> $1/fluff.log
