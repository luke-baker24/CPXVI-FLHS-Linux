cronscan()
{
    echo "
=====================================================================
Running a cronjob scan
=====================================================================
"

    #Look for running crontabs
    #grep -rv "#" /var/spool/cron/crontabs/

    #Some crontabs can be hidden from the running crontab and instead are here
    ls -A /etc/cron.d/
    ls -A /etc/cron.daily/
    ls -A /etc/cron.hourly/
    ls -A /etc/cron.monthly/
    ls -A /etc/cron.weekly/

    #Some cronjobs appear here instead
    echo ""
    grep -v "#" /etc/anacrontab
    grep -v "#" /etc/crontab
}

bashenvscan()
{
    echo "
=====================================================================
Running a bash environment scan scan
=====================================================================
"

    getent passwd | egrep ":[0-9][0-9][0-9][0-9]:" | while IFS=: read -r name password uid gid gecos home shell
    do
        echo "[SCAN] running a scan on $name's bash environment... ensure no results are returned."

        echo "bashrc:"
        diff /home/$name/.bashrc ../baselines/bashrc    
        echo "profile:"
        diff /home/$name/.profile ../baselines/profile
        echo "logout:"
        diff /home/$name/.basah_logout ../baselines/bash_logout
    done

    echo "Path is: " + $PATH
    echo "Remember to check your path and the root path."
}

rootkitscan()
{
    echo "
=====================================================================
Running rootkit scans
=====================================================================
"

    #Rkhunter scan
    rkhunter --checkall --skip-keypress --nocolors

    #Chkrootkit scan
    chkrootkit
}

malwarescan()
{
    echo "
=====================================================================
Running malware scans
=====================================================================
"

    #Clamscan
    clamscan -r / --suppress-ok-results --exclude-dir=^/snap/ / 2> /dev/null

    #Maldet scan
    wget https://www.rfxn.com/downloads/maldetect-current.tar.gz
    gunzip maldetect-current.tar.gz
    tar -xvf maldetect-current.tar

    cd $(ls | grep maldetect | grep -v zip)
        ./install.sh
    cd ..

    maldet --scan-all /
}

networkscan()
{
    echo "
=====================================================================
Running network scans
=====================================================================
"
    echo "[SCAN] Netstat:"
    netstat -alpn | grep LISTEN

    echo "[SCAN] Nmap:"
    nmap -sV localhost
}

filescan()
{
    echo "
=====================================================================
Running homedir file scans
=====================================================================
"

    echo "[SCAN] Ensure no results are returned - otherwise investigate."

    ALL_FILES=$(find /home/$USER -type f -exec file {} + | 
    grep -v /home/$USER/snap/ | 
    grep -v /home/$USER/.config/ | 
    grep -v /home/$USER/.cache/ | 
    grep -v /home/$USER/.bash_history |
    grep -v /home/$USER/.bash_logout | 
    grep -v /home/$USER/.bashrc |
    grep -v CPXV-FLHS)

    echo "$ALL_FILES" | grep Downloads
    echo "$ALL_FILES" | grep Documents
    echo "$ALL_FILES" | grep Desktop
    echo "$ALL_FILES" | grep Pictures
    echo "$ALL_FILES" | grep Videos
    echo "$ALL_FILES" | grep Music
    
    echo "$ALL_FILES" | grep jpg
    echo "$ALL_FILES" | grep png
    echo "$ALL_FILES" | grep mp3
    echo "$ALL_FILES" | grep mp4
    echo "$ALL_FILES" | grep mov
    echo "$ALL_FILES" | grep wav
    echo "$ALL_FILES" | grep avi
    echo "$ALL_FILES" | grep mpg
    echo "$ALL_FILES" | grep mpeg
    echo "$ALL_FILES" | grep flac
    echo "$ALL_FILES" | grep m4a
    echo "$ALL_FILES" | grep flv
    echo "$ALL_FILES" | grep ogg
    echo "$ALL_FILES" | grep gif
    echo "$ALL_FILES" | grep jpeg
    echo "$ALL_FILES" | grep txt
    echo "$ALL_FILES" | grep zip
    echo "$ALL_FILES" | grep deb
    echo "$ALL_FILES" | grep tar
    echo "$ALL_FILES" | grep rar
    echo "$ALL_FILES" | grep gz
    echo "$ALL_FILES" | grep sh
    echo "$ALL_FILES" | grep pdf
    echo "$ALL_FILES" | grep svg
    echo "$ALL_FILES" | grep pass
    echo "$ALL_FILES" | grep word
    echo "$ALL_FILES" | grep pw
    echo "$ALL_FILES" | grep russia
    echo "$ALL_FILES" | grep china
    echo "$ALL_FILES" | grep hack
    echo "$ALL_FILES" | grep exploit
}

echo "
=====================================================================
Running malware/policy violation scans
=====================================================================
" >> $1/flush.log

cronscan      >> $1/flush.log
rootkitscan   >> $1/flush.log
malwarescan   >> $1/flush.log
bashenvscan   >> $1/flush.log
filescan      >> $1/flush.log